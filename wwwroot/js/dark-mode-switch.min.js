var darkMode = document.getElementById('darkMode');
var isDark;
var theme;

Init();

function Init() {
    var url = '/Users/InitTheme';
    $.ajax({
        type: 'GET',
        url: url,
        processData: false,
        contentType: false
    }).done(function (response) {
        if (response.status === "success") {
            isDark = response.isDark;
            theme = response.theme;
            init(isDark,theme);
        }
    });
};


darkMode.addEventListener('change', function () {
    var url = $("#darkThemePost").attr("action");
    $.ajax({
        type: 'POST',
        url: url,
        processData: false,
        contentType: false
    }).done(function (response) {
        if (response.status === "success") {
            resetTheme(response.theme)
        }
    });
});


function init(isDark,theme) {
    if (isDark == true) {
        $('#darkMode').attr('checked', true);
        $("#darkModeLabel").text(theme);
        $("#lightDarkScheme").attr("media", "(prefers-color-scheme: dark)");
        localStorage.media = "(prefers-color-scheme: dark)";
    }
    else {
        $('#darkMode').attr('checked', false);
        $("#darkModeLabel").text(theme);
        $("#lightDarkScheme").attr("media", "(prefers-color-scheme: light)");
        localStorage.media = "(prefers-color-scheme: light)";

    }
}


function resetTheme(theme) {
    if (darkMode.checked) {
        $("#darkModeLabel").text(theme);
        localStorage.media = "(prefers-color-scheme: dark)";
        $("#lightDarkScheme").attr("media", "(prefers-color-scheme: dark)");


    } else {
        $("#darkModeLabel").text(theme);

        localStorage.media = "(prefers-color-scheme: light)";

        $("#lightDarkScheme").attr("media", "(prefers-color-scheme: light)");
    }
}



